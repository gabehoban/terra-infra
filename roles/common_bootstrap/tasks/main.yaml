---
- name: Ensure Github ssh keys are present
  ansible.posix.authorized_key:
    user: "{{ ansible_user }}"
    key: https://github.com/gabehoban.keys
    state: present

- name: Ensure hostname is correct
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"

- name: Ensure 127.0.1.1 is correct
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '^127\.0\.1\.1'
    line: "127.0.1.1 {{ inventory_hostname }}"

- name: Upgrade apt packages
  ansible.builtin.apt:
    upgrade: full
    update_cache: true

- name: Install necessary apt packages
  ansible.builtin.apt:
    name:
      - curl
      - git
      - htop
      - iptables
      - lm-sensors
      - net-tools
      - python3
      - restic
      - smartmontools
      - tmux
      - unzip
      - uptimed
      - vim
      - wget
      - zsh
    state: present

- name: Autoremove apt packages
  become: true
  ansible.builtin.apt:
    autoremove: true
